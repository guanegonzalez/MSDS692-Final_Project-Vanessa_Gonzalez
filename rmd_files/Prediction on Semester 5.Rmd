---
title: "Prediction of Students at Risk on Semester 5"
author: "Vanessa Gonzalez"
date: "`r format(Sys.Date())`"
output: html_notebook
---

Open Libraries.
```{r}
library("mlbench")
library("caret")
library("randomForest")
library("lattice")
library("ggplot2")
library("rpart")
library("e1071")
library("caret", lib.loc="/Library/Frameworks/R.framework/Versions/3.4/Resources/library")
```


## Random Forest model using less variables for semester 5

```{r}
colnames(dfDataSet4YGImpute) <- c("FourYG", "One.CSCI101","One.MATH111","Two.CSCI261","Two.MATH112","Two.MATH201","Three.CSCI262","Three.MATH213","Four.CSCI341","Four.CSCI358","Four.MATH225","Five.CSCI306","Five.CSCI403","Five.MATH332","Six.CSCI406","Seven.CSCI370","Eight.CSCI400","Eight.CSCI442")
LessVariablesSet.Sem5 <- dfDataSet4YGImpute
```
```{r}
LessVariablesSet.Sem5
```
Create data partitions and remove variables to leave only classes before 6th semester.
```{r}
# Creates Data Partitions and removes variables
inTrainingLess.Sem5 <- createDataPartition(LessVariablesSet.Sem5$FourYG, p = 0.80, list = FALSE)
LessVariablesSet.Sem5 <- LessVariablesSet[-(2:3)]
LessVariablesSet.Sem5 <- LessVariablesSet[-(3)]
LessVariablesSet.Sem5 <- LessVariablesSet[-(5)]
LessVariablesSet.Sem5 <- LessVariablesSet[-(7)]
LessVariablesSet.Sem5 <- LessVariablesSet[-(11)]

LessVariablesSet.Sem5 <- LessVariablesSet[-(11:12)]
str(LessVariablesSet.Sem5)
```
```{r}
# Creates Training data Set
trainingLess.Sem5 <- LessVariablesSet.Sem5[inTrainingLess.Sem5, ]
# Creates Testing data Set
testingLess.Sem5 <- LessVariablesSet.Sem5[-inTrainingLess.Sem5, ]
# Data Set with less varialbes
head(LessVariablesSet.Sem5)
```
```{r}
trainingLess.Sem5
```

```{r}
testingLess.Sem5

```

##Regresion Partition with method "class" for less variables for 5th semester courses.
```{r}
FourYG.rp.Less.Sem5 = rpart(FourYG ~ ., data=trainingLess.Sem5, method = "class")
FourYG.rp.Less.Sem5
```

```{r}

printcp(FourYG.rp.Less.Sem5)
```
Summary for regression partition.
```{r}
summary(FourYG.rp.Less.Sem5)
```
Prediction for regretion partition for less courses before Semester 5.
```{r}
predictionsLess.Sem5 = predict(FourYG.rp.Less.Sem5, testingLess.Sem5, type="class")
table(testingLess.Sem5$FourYG, predictionsLess.Sem5)

```
Confusion Matrix
```{r}
library(caret)
confusionMatrix(table(predictionsLess.Sem5, testingLess.Sem5$FourYG))

```
```{r}
min(FourYG.rp.Less.Sem5$cptable[,"xerror"])
```
```{r}
which.min(FourYG.rp.Less.Sem5$cptable[,"xerror"])
```
Get the cost complecity parameter of the record
```{r}
FourYG.cp.Less.Sem5 = FourYG.rp.Less.Sem5$cptable[1,"CP"]
FourYG.cp.Less.Sem5

```

Prune tree.
```{r}
prune.tree.Less.Sem5 = prune(FourYG.rp.Less.Sem5, cp = FourYG.cp.Less.Sem5)
predictionsLessPrune.Sem5 = predict(prune.tree.Less.Sem5, testingLess.Sem5, type="class")
table(testingLess.Sem5$FourYG, predictionsLessPrune.Sem5)

```
Confusion Matrix
```{r}
confusionMatrix(table(predictionsLessPrune.Sem5, testingLess.Sem5$FourYG))
```

Top 10 variables

```{r}
str(LessVariablesSet.Sem5)
```
## Random Forest method with less variables on 5th semester.
Training
```{r}
FourYG.rf.Less.Sem5 <- randomForest(FourYG ~Two.CSCI261+Two.MATH201+Four.CSCI341+Four.CSCI358+Five.CSCI306+Five.CSCI403+Five.MATH332+Six.CSCI406 , data = trainingLess.Sem5)
FourYG.rf.Less.Sem5
```
Prediction
```{r}
FourYG.rf.prediction.Less.Sem5 <- predict(FourYG.rf.Less.Sem5, testingLess.Sem5)
table(FourYG.rf.prediction.Less.Sem5, testingLess.Sem5$FourYG)
```

Importance of variables.
```{r}
importance(FourYG.rf.Less.Sem5)
```

Plot of importance of Variabels.
```{r}
varImpPlot(FourYG.rf.Less.Sem5)
```
Confusion Matrix
```{r}
confusionMatrix(table(FourYG.rf.prediction.Less.Sem5, testingLess.Sem5$FourYG))
```
## Logistic Regression method for variable importance

```{r}
# Template code
# Step 1: Build Logit Model on Training Dataset

FourYG.lr.Less.Sem5 <- glm(FourYG ~Two.CSCI261+Two.MATH201+Four.CSCI341+Four.CSCI358+Five.CSCI306+Five.CSCI403+Five.MATH332+Six.CSCI406, family= "binomial", data = trainingLess.Sem5)
FourYG.lr.Less.Sem5

# Step 2: Predict Y on Test Dataset
predicted.lr.Less.Sem5 <- predict(FourYG.lr.Less.Sem5, testingLess.Sem5, type="response") 
```
Variable Importance
```{r}
gbmImp.Less.Sem5 <- varImp(FourYG.rf.Less.Sem5, scale = FALSE)
gbmImp.Less.Sem5
```




